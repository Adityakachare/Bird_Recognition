<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
      name="description"
      content="Explore bird recordings and their detailed information."
    />
    <meta name="author" content="Tweet Stop" />
    <title>Tweet Spot - Bird Audio Recording Services</title>
    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Fontawesome CSS -->
    <link href="css/all.css" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Navigation -->
    <nav
      class="navbar fixed-top navbar-expand-lg navbar-dark bg-light top-nav fixed-top"
    >
      <div class="container">
        <a class="navbar-brand" href="index.html">
          <img src="images/logo.png" alt="logo" />
        </a>
        <button
          class="navbar-toggler navbar-toggler-right"
          type="button"
          data-toggle="collapse"
          data-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="fas fa-bars"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">Our Recordists</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="services.html">Services</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="BirdRecordings.html"
                >Bird Recordings</a
              >
            </li>

            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdownBlog"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Pages
              </a>
              <div
                class="dropdown-menu dropdown-menu-right"
                aria-labelledby="navbarDropdownBlog"
              >
                <a class="dropdown-item" href="faq.html">FAQ</a>
                <a class="dropdown-item" href="404.html">404</a>
                <a class="dropdown-item" href="pricing.html">Pricing Table</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Full Title -->
    <div class="full-title">
      <div class="container">
        <!-- Page Heading -->
        <h1 class="mt-4 mb-3">
          Bird Recordings
          <small>Explore bird sounds and their fascinating details</small>
        </h1>
      </div>
    </div>

    <div class="container">
      <div class="breadcrumb-main">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item active">Recordings</li>
        </ol>
      </div>

      <div class="container text-center my-3">
        <div
          id="letters-navigation"
          class="d-flex justify-content-center flex-wrap"
        >
          <!-- Letters will be dynamically generated here -->
        </div>
      </div>

      <!-- Bird Cards Section -->
      <div class="container">
        <div class="row" id="bird-records-container"></div>
      </div>
    </div>

    <!--modal-->
    <!-- Footer -->
    <footer class="footer">
      <div class="container bottom_border">
        <div class="row">
          <div class="col-lg-3 col-md-6 col-sm-6 col">
            <h5 class="headin5_amrc col_white_amrc pt2">Find Us</h5>
            <p class="mb10">
              Explore the beauty of bird sounds with Tweet Spot. Discover,
              learn, and connect with nature.
            </p>
            <p>
              <i class="fa fa-location-arrow"></i> 123 Birdwatch Lane, Nature
              City, NC 27559
            </p>
            <p><i class="fa fa-phone"></i> +91-9998765432</p>
            <p><i class="fa fa-envelope"></i> info@tweetspot.com</p>
          </div>
          <div class="col-lg-3 col-md-6 col-sm-6 col">
            <h5 class="headin5_amrc col_white_amrc pt2">Follow Us</h5>
            <ul class="footer_ul2_amrc">
              <li>
                <a href="#"
                  ><i class="fab fa-twitter fleft padding-right"></i>
                </a>
                <p>
                  Stay updated with our latest news!
                  <a href="#">https://twitter.com/tweetspot</a>
                </p>
              </li>
              <li>
                <a href="#"
                  ><i class="fab fa-facebook-f fleft padding-right"></i>
                </a>
                <p>
                  Join our community on Facebook!
                  <a href="#">https://facebook.com/tweetspot</a>
                </p>
              </li>
              <li>
                <a href="#"
                  ><i class="fab fa-instagram fleft padding-right"></i>
                </a>
                <p>
                  Follow our birdwatching adventures on Instagram!
                  <a href="#">https://instagram.com/tweetspot</a>
                </p>
              </li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-6 col-sm-6">
            <h5 class="headin5_amrc col_white_amrc pt2">Quick Links</h5>
            <ul class="footer_ul_amrc">
              <li><a href="#">Home</a></li>
              <li><a href="#">About Us</a></li>
              <li><a href="#">Bird Identification</a></li>
              <li><a href="#">Contact Us</a></li>
              <li><a href="#">FAQs</a></li>
              <li><a href="#">Blog</a></li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-6 col-sm-6">
            <h5 class="headin5_amrc col_white_amrc pt2">Recent Posts</h5>
            <ul class="footer_ul_amrc">
              <li class="media">
                <div class="media-left">
                  <img
                    class="img-fluid"
                    src="images/post-img-01.jpg"
                    alt="Bird post image"
                  />
                </div>
                <div class="media-body">
                  <p>Top 5 Birds to Spot This Spring</p>
                  <span>22 Mar 2024</span>
                </div>
              </li>
              <li class="media">
                <div class="media-left">
                  <img
                    class="img-fluid"
                    src="images/post-img-02.jpg"
                    alt="Bird post image"
                  />
                </div>
                <div class="media-body">
                  <p>How to Record Bird Sounds Effectively</p>
                  <span>18 Mar 2024</span>
                </div>
              </li>
              <li class="media">
                <div class="media-left">
                  <img
                    class="img-fluid"
                    src="images/post-img-03.jpg"
                    alt="Bird post image"
                  />
                </div>
                <div class="media-body">
                  <p>Understanding Bird Calls: A Beginner's Guide</p>
                  <span>15 Mar 2024</span>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="footer-logo">
          <img src="images/logo.png" alt="logo" />
        </div>
        <p class="copyright text-center">
          All Rights Reserved. &copy; 2024 <a href="#">Tweet Spot</a>. Design
          By:
          <a href="ITA03">ITA03</a>
        </p>
        <ul class="social_footer_ul">
          <li>
            <a href="#"><i class="fab fa-facebook-f"></i></a>
          </li>
          <li>
            <a href="#"><i class="fab fa-twitter"></i></a>
          </li>
          <li>
            <a href="#"><i class="fab fa-linkedin"></i></a>
          </li>
          <li>
            <a href="#"><i class="fab fa-instagram"></i></a>
          </li>
        </ul>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById("bird-records-container");

        // Show loading message immediately when the page loads
        container.innerHTML = "<h5>Loading bird data...</h5>";

        fetch("http://127.0.0.1:5000/birds")
          .then((response) => {
            if (!response.ok)
              throw new Error(`Failed to fetch: ${response.status}`);
            return response.json();
          })
          .then((data) => {
            console.log("Bird data loaded:", data);

            const letters = Object.keys(data).sort();
            const lettersNav = document.getElementById("letters-navigation");

            // Generate clickable letter buttons
            letters.forEach((letter) => {
              const letterBtn = document.createElement("button");
              letterBtn.className = "btn btn-outline-success m-1";
              letterBtn.dataset.letter = letter;
              letterBtn.textContent = letter;
              lettersNav.appendChild(letterBtn);
            });

            // Helper function: Get unique birds from the data
            const getUniqueBirds = (birds) => {
              const birdMap = new Map();
              birds.forEach((bird) => {
                if (!birdMap.has(bird["bird name"])) {
                  birdMap.set(bird["bird name"], bird);
                }
              });
              return Array.from(birdMap.values());
            };

            const getDriveImageUrl = (url) => {
              if (!url) return "images/default-bird.jpeg"; // Fallback image
              const match = url.match(/(?:\/d\/|id=)([a-zA-Z0-9_-]+)/);
              if (match) {
                return `https://drive.google.com/thumbnail?id=${match[1]}&sz=w600`;
              }
              return url;
            };

            // Function to render bird cards (unique birds only!)
            const renderBirdCards = (birds) => {
              container.innerHTML = ""; // Clear loading message or old cards
              const uniqueBirds = getUniqueBirds(birds);

              if (uniqueBirds.length === 0) {
                container.innerHTML =
                  "<h5>No birds found for this letter.</h5>";
              } else {
                uniqueBirds.forEach((bird) => {
                  const birdCard = `
              <div class="col-md-6 mb-4">
                <div class="card h-100 shadow-sm">
                  <img src="${getDriveImageUrl(
                    bird.img_url
                  )}" class="card-img-top" style="height: 350px; object-fit: cover;" alt="${
                    bird["bird name"]
                  }">
                  <div class="card-body">
                    <h4 class="card-title">${bird["bird name"]}</h4>
                    <p><strong>Info:</strong> ${
                      bird["bird info"] || "No info available"
                    }</p>
                    <p><strong>Family:</strong> ${bird.family}</p>
                    <p><strong>Group Info:</strong> ${
                      bird["group info"] || "No group info available"
                    }</p>
                    <p><strong>Order:</strong> ${bird.order}</p>
                    <p><strong>Scientific Name:</strong> ${
                      bird["scientific name"]
                    }</p>
                  </div>
                </div>
              </div>`;
                  container.innerHTML += birdCard;
                });
              }
            };

            // Display all unique birds initially
            const allBirds = [].concat(...Object.values(data));
            renderBirdCards(allBirds);

            // Add event listeners to each letter button
            lettersNav.querySelectorAll("button").forEach((button) => {
              button.addEventListener("click", (e) => {
                const selectedLetter = e.target.getAttribute("data-letter");
                const filteredBirds = data[selectedLetter] || [];
                renderBirdCards(filteredBirds);

                // Highlight active button with aria-pressed
                lettersNav.querySelectorAll("button").forEach((btn) => {
                  btn.classList.remove("active");
                  btn.setAttribute("aria-pressed", "false");
                });
                e.target.classList.add("active");
                e.target.setAttribute("aria-pressed", "true");
              });
            });
          })
          .catch((error) => {
            console.error("Error fetching bird data:", error);
            container.innerHTML = `<h5>Failed to load bird data. Please try again.</h5>`;
          });
      });
    </script>
  </body>
</html>
